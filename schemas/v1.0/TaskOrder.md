## ğŸ“– ã€ŠTaskOrder v1.0ã€‹è¯´æ˜æ–‡æ¡£

> çŠ¶æ€ï¼šfinal
> 
> 
> é€‚ç”¨èŒƒå›´ï¼šCREEP å…¨æ ˆç³»ç»Ÿä¸­ï¼Œå¯¹â€œä»»åŠ¡å·¥å•â€çš„ç»Ÿä¸€ç»“æ„å®šä¹‰
> 

---

### 1. ç‰ˆæœ¬ä¿¡æ¯

- **Schema åç§°**ï¼š`TaskOrder`
- **ç‰ˆæœ¬å·**ï¼š`v1.0`
- **å‘å¸ƒç¼–å·**ï¼š`S-DOC-001-02`
- **çŠ¶æ€**ï¼š`final`
- **å‘å¸ƒä¸»ä½“**ï¼šè‡ªç„¶æ§åˆ¶ç³»ç»Ÿæ ¸å¿ƒæ‰§è¡Œä½“ / CREEP åè®®å±‚
- **å‘å¸ƒæ—¥æœŸ**ï¼š2025-06-22

---

### 2. ç»“æ„æ€»è§ˆ

`TaskOrder v1.0` æè¿°çš„æ˜¯ï¼š

> â€œä¸€å¼ ä»»åŠ¡å·¥å•ï¼Œä»åˆ›å»ºåˆ°å®Œæˆ/å¤±è´¥çš„å®Œæ•´å¤´éƒ¨ä¿¡æ¯â€
> 

å®ƒæ‰¿æ‹…çš„æ˜¯ **â€œåŠ¨è¯è§†è§’â€**ï¼š

- è°ï¼ˆå“ªä¸ª tenant / projectï¼‰å‘èµ·äº†ä»»åŠ¡ï¼Ÿ
- æƒ³å¹²ä»€ä¹ˆï¼ˆtask_type / task_category / resource_hintsï¼‰ï¼Ÿ
- ä»·å€¼å’Œçº¦æŸæ˜¯ä»€ä¹ˆï¼ˆbusiness_value_hint / priority / timeout_ms / max_total_costï¼‰ï¼Ÿ
- å½“å‰èµ°åˆ°ç”Ÿå‘½å‘¨æœŸçš„å“ªä¸€æ­¥äº†ï¼ˆPENDING / RUNNING / SUCCESS...ï¼‰ï¼Ÿ
- æœ€ç»ˆç»“æœå¦‚ä½•ï¼ˆresult_code / result_messageï¼‰ï¼Ÿ
- å®ƒç»‘å®šäº†å“ªäº› Leaseï¼ˆé—´æ¥æŒ‡å‘ Assetï¼‰ï¼Ÿ

**ç‰¹åˆ«å¼ºè°ƒï¼š**

- TaskOrder **ä¸ç›´æ¥å¼•ç”¨ `asset_id`**ã€‚
- Task ä¸èµ„æºçš„ç»‘å®šé€šè¿‡ `lease_id` é—´æ¥å…³è”åˆ° AssetSnapshotï¼š
    - å³ï¼š`TaskOrder` â†’ `Lease` â†’ `AssetSnapshot`ã€‚
- è¿™ä¿è¯äº†ï¼š
    - Task å±‚åªå…³å¿ƒâ€œè¦å¹²ä»€ä¹ˆâ€å’Œâ€œç”¨äº†å“ªäº›ç§Ÿçº¦â€ï¼›
    - Asset å±‚åªå…³å¿ƒâ€œå½“å‰ä¸–ç•ŒçŠ¶æ€â€ã€‚

---

### 3. å­—æ®µè¯´æ˜

### 3.1 èº«ä»½ä¸å½’å±

- `task_id`
    - ä»»åŠ¡å”¯ä¸€ IDï¼ˆUUIDï¼‰ï¼Œç”± CREEP æ§åˆ¶é¢ç”Ÿæˆã€‚
    - æ‰€æœ‰äº‹ä»¶ã€è´¦æœ¬ã€Lease è®°å½•ç­‰ï¼Œå‡å¯é€šè¿‡ `task_id` å…³è”åˆ°æ­¤å·¥å•ã€‚
- `idempotency_key`
    - **å¹‚ç­‰é”®**ï¼Œç”± **ä¸Šæ¸¸è°ƒç”¨æ–¹** ç”Ÿæˆçš„è¯·æ±‚ IDã€‚
    - çº¦æŸèŒƒå›´ï¼ˆå¼ºåˆ¶è¯­ä¹‰ï¼‰ï¼š
        - `(tenant_id, env, idempotency_key)` ä¸‰å…ƒç»„åœ¨ç³»ç»Ÿä¸­å¿…é¡»å…¨å±€å”¯ä¸€ï¼›
        - å¯¹åŒä¸€ä¸ªä¸‰å…ƒç»„çš„é‡å¤åˆ›å»ºè¯·æ±‚ï¼Œå¿…é¡»è¿”å›**åŒä¸€å¼  TaskOrder**ï¼Œè€Œä¸æ˜¯æ–°å»ºã€‚
    - ç”¨é€”ï¼š
        - é˜²æ­¢ MES / ä¸Šæ¸¸ç³»ç»Ÿåœ¨ç½‘ç»œè¶…æ—¶é‡è¯•æ—¶äº§ç”Ÿâ€œå¹½çµåŒå•â€ï¼ˆé‡å¤ä¸‹å•ã€é‡å¤æ‰£è´¹ï¼‰ï¼›
        - ä¸ºæœªæ¥çš„åˆ†å¸ƒå¼å¯¹è´¦æä¾›é”šç‚¹ã€‚
- `tenant_id`
    - æ‰€å±ç§Ÿæˆ· IDï¼Œä¸ AssetSnapshot / LedgerEntry ä¸­çš„ `tenant_id` å¯¹é½ã€‚
- `project_id`
    - é¡¹ç›® / æˆæœ¬ä¸­å¿ƒï¼Œç”¨äº FinOps æŒ‰ä¸šåŠ¡çº¿å½’é›†æˆæœ¬ä¸æ”¶å…¥ã€‚
- `env`
    - ä»»åŠ¡æ‰€åœ¨ç¯å¢ƒï¼ˆ`prod` / `staging` / `dev` / `sandbox` ç­‰ï¼‰ã€‚
    - å¹‚ç­‰çº¦æŸç‰¹æ„åŒ…å« `env`ï¼Œé¿å…æµ‹è¯•ç¯å¢ƒçš„åŒåå¹‚ç­‰é”®æ±¡æŸ“ç”Ÿäº§ã€‚
- `external_ref`
    - ä¸Šæ¸¸ç³»ç»Ÿçš„å·¥å•å·æˆ–è¯·æ±‚ IDï¼Œå…è®¸å¤–éƒ¨ç³»ç»Ÿè‡ªå¸¦ä¸šåŠ¡ä¸»é”®ã€‚

---

### 3.2 ä»»åŠ¡è¯­ä¹‰ä¸åˆ†ç±»

- `task_type`
    - ä»»åŠ¡çš„å…·ä½“ç±»å‹æ ‡è¯†ï¼Œæ¯”å¦‚ï¼š
        - `E2E_CHECKOUT`
        - `TICKET_SNIPER`
        - `CAPTCHA_SOLVE`
        - `SYNTHETIC_MONITOR`
    - ç”±ä¸šåŠ¡æ–¹å®šä¹‰æšä¸¾é›†åˆã€‚
- `task_category`
    - æ›´é«˜ä¸€å±‚çš„ä»»åŠ¡åŸŸï¼Œä¾‹å¦‚ï¼š
        - `QA`, `FINOPS`, `EXCHANGE`, `CHAOS`
    - å¯é€‰å­—æ®µï¼Œç”¨äºæŠ¥è¡¨ä¸ç­–ç•¥è·¯ç”±ã€‚
- `description`
    - å¯é€‰çš„äººç±»å¯è¯»æè¿°ã€‚

---

### 3.3 è°ƒåº¦æ ¸å¿ƒï¼šä¼˜å…ˆçº§ä¸è¶…æ—¶æ§åˆ¶

- `priority`
    - æ•´æ•° 0â€“100ï¼š
        - æ•°å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼›
        - è°ƒåº¦å¼•æ“å¯ä»¥ç®€å•åœ°æŒ‰ `(priority, created_at)` æ’åºé˜Ÿåˆ—ã€‚
    - æ¨èçº¦å®šï¼š
        - 0â€“20ï¼šèƒŒæ™¯ä»»åŠ¡ / ä½ä»·å€¼ä»»åŠ¡ï¼›
        - 50ï¼šé»˜è®¤ï¼›
        - 80+ï¼šæŠ¢ç¥¨ã€å…³é”®è·¯å¾„ E2E æµ‹è¯•ç­‰é«˜ä»·å€¼ä»»åŠ¡ã€‚
- `timeout_ms`
    - å•æ¬¡ä»»åŠ¡å…è®¸çš„æœ€é•¿æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œä» `started_at` èµ·ç®—ã€‚
    - è°ƒåº¦å™¨å¯æ®æ­¤å®ç°ï¼š
        - Worker ä¾§è¶…æ—¶å–æ¶ˆï¼›
        - æ§åˆ¶é¢ä¾§å°† `RUNNING` ä»»åŠ¡è¿ç§»åˆ° `TIMEOUT` çŠ¶æ€ï¼›
        - å¯¹é•¿æ—¶é—´â€œå¡æ­»â€çš„ Lease åšå›æ”¶ã€‚

---

### 3.4 ä»·å€¼ä¸é¢„ç®—çº¦æŸ

- `max_total_cost`
    - æœ¬ä»»åŠ¡å…è®¸æ¶ˆè€—çš„æˆæœ¬ä¸Šé™ï¼ˆå¯é€‰ï¼›å•ä½ä¸º `currency`ï¼‰ã€‚
    - FinOps + è°ƒåº¦ç­–ç•¥å¯æ®æ­¤å®ç°ï¼š
        - è¶…æˆæœ¬æ—¶è‡ªåŠ¨é™çº§èµ„æºï¼ˆä»é«˜ä»· IP åˆ‡åˆ°ä¾¿å®œ IPï¼‰ï¼›
        - è¾¾åˆ°ä¸Šé™æ—¶å¼ºåˆ¶ç»“æŸä»»åŠ¡æˆ–æ‹’ç»åˆ›å»ºæ–°çš„ Leaseã€‚
- `currency`
    - ä»»åŠ¡é¢„ç®—çš„å¸ç§ï¼ˆ`USD` / `USDT` / `EUR`...ï¼‰ï¼Œ
    - å¿…é¡»ä¸ç›¸å…³ LedgerEntry çš„å¸ç§å¯¹é½ï¼Œä¾¿äºåç»­æ±‡æ€»ã€‚
- `business_value_hint`
    - ä¸šåŠ¡ç»™å‡ºçš„â€œè¿™å•æˆåŠŸå€¼å¤šå°‘é’±â€çš„ä¼°è®¡å€¼ï¼ˆå¯é€‰ï¼‰ã€‚
    - è°ƒåº¦æ—¶å¯ç”¨äºï¼š
        - é«˜ä»·å€¼ä»»åŠ¡åˆ†é…é«˜è´¨é‡èµ„æºï¼›
        - ä¸ `max_total_cost` ç»“åˆåš ROI è¯„ä¼°ã€‚

---

### 3.5 ç”Ÿå‘½å‘¨æœŸä¸ç»“æœ

- `status`
    - ä»»åŠ¡å½“å‰çŠ¶æ€ï¼Œæšä¸¾ï¼š
        - `PENDING`ï¼šåˆšåˆ›å»ºï¼Œå°šæœªè¿›å…¥é˜Ÿåˆ—ï¼›
        - `QUEUED`ï¼šå·²è¿›å…¥è°ƒåº¦é˜Ÿåˆ—ï¼Œç­‰å¾…èµ„æºï¼›
        - `RUNNING`ï¼šè‡³å°‘æœ‰ä¸€ä¸ª Worker æ­£åœ¨æ‰§è¡Œï¼›
        - `SUCCESS`ï¼šä»»åŠ¡å®Œæˆï¼Œä¸šåŠ¡æ„ä¹‰ä¸ŠæˆåŠŸï¼›
        - `FAILED`ï¼šä»»åŠ¡å®Œæˆï¼Œä¸šåŠ¡æ„ä¹‰ä¸Šå¤±è´¥ï¼ˆéè¶…æ—¶ã€éå–æ¶ˆï¼‰ï¼›
        - `CANCELLED`ï¼šè¢«ä¸Šæ¸¸æˆ–ç³»ç»Ÿä¸»åŠ¨å–æ¶ˆï¼›
        - `TIMEOUT`ï¼šæ‰§è¡Œè¶…æ—¶ï¼›
        - `DEAD_LETTER`ï¼šè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼ˆå¤šæ¬¡å¤±è´¥æˆ–ä¸å¯æ¢å¤é”™è¯¯ï¼‰ã€‚
- `created_at` / `queued_at` / `started_at` / `finished_at`
    - æ ‡å‡† ISO8601 æ—¶é—´æˆ³ï¼Œè®°å½•ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸå…³é”®æ—¶é—´ç‚¹ã€‚
    - `queued_at`ã€`started_at`ã€`finished_at` å¯ä¸ºç©ºã€‚
- `result_code`
    - ç»“æœçš„æ ‡å‡†åŒ–ç¼–ç ï¼Œå¦‚ï¼š
        - `OK`, `SOFT_FAIL`, `HARD_FAIL`, `BANNED`, `RETRYABLE`, `NO_RESOURCE` ç­‰ã€‚
- `result_message`
    - äººç±»å¯è¯»çš„ç»“æœæ‘˜è¦ï¼Œç”¨äºæ—¥å¿—ä¸æ’æŸ¥ã€‚
- `task_version`
    - æ•´æ•° â‰¥ 1ï¼š
        - ç”¨äºä¹è§‚é”æ§åˆ¶ï¼ˆé¿å…å¤šæœåŠ¡åŒæ—¶æ›´æ–°åŒä¸€ Task æ—¶å‡ºç°â€œæœ€åå†™ winsâ€è¦†ç›–ï¼‰ï¼›
        - æ¯æ¬¡å¯¹ TaskOrder çš„å˜æ›´ï¼ˆçŠ¶æ€/ç»“æœ/lease_ids ç­‰ï¼‰éƒ½åº”å¢åŠ  `task_version`ã€‚
- `updated_at`
    - æœ€è¿‘ä¸€æ¬¡æ›´æ–° TaskOrder çš„æ—¶é—´ã€‚

---

### 3.6 èµ„æºä¸ç§Ÿçº¦å¼•ç”¨ï¼ˆå›ç­”â€œTask ä¸ Asset çš„å¼•ç”¨å…³ç³»â€ï¼‰

**æ ¸å¿ƒåŸåˆ™ï¼š**

> TaskOrder ä¸ç›´æ¥å¼•ç”¨ AssetSnapshot çš„ asset_idã€‚
> 
> 
> å®ƒåªçŸ¥é“è‡ªå·±çš„ Lease åˆ—è¡¨ï¼š`lease_ids`ã€‚
> 
> èµ„äº§å±‚å…³ç³»ç”± Lease ä¸ AssetSnapshot è´Ÿè´£ã€‚
> 
- `lease_ids`
    - å½“å‰ä¸æœ¬ä»»åŠ¡ç»‘å®šçš„ Lease ID åˆ—è¡¨ï¼ˆUUID æ•°ç»„ï¼‰ã€‚
    - è¯­ä¹‰ï¼š
        - åˆ—è¡¨ä¸­æ¯ä¸€ä¸ª `lease_id` ä»£è¡¨ä¸€æ¬¡èµ„æºç§Ÿç”¨ï¼›
        - å…·ä½“ç§Ÿç”¨äº†å“ªäº› Assetï¼Œç”± Lease è®°å½•æä¾›ï¼›
        - Task å®Œæˆåï¼Œå¯æŒ‰ç­–ç•¥é€‰æ‹©ï¼š
            - ä¿ç•™ Leaseï¼ˆé•¿å‘¨æœŸä»»åŠ¡ï¼Œå¦‚é•¿æœŸç›‘æ§ï¼‰ï¼›
            - æˆ– Task å®Œæˆå³é‡Šæ”¾ Leaseï¼ˆä¸€æ¬¡æ€§ä»»åŠ¡ï¼‰ã€‚

> è®¾è®¡ç†ç”±ï¼š
> 
> - è§£è€¦ Task ä¸ Assetï¼šåŒä¸€ Task å¯ä»¥è·¨ç”Ÿå‘½å‘¨æœŸç»‘å®šä¸åŒ Leaseï¼›
> - å…è®¸åç»­å¼•å…¥â€œä»»åŠ¡é‡è¯•ä½†é‡ç”¨éƒ¨åˆ† Leaseâ€çš„å¤æ‚ç­–ç•¥ã€‚

---

### 3.7 èµ„æºè¯·æ±‚æ„å›¾ï¼ˆResource Hintsï¼‰

- `resource_hints`
    - æ•°ç»„ï¼Œæ¯ä¸€é¡¹æè¿°ä¸€ç±»èµ„æºéœ€æ±‚ï¼š
    
    ```json
    {
      "sku_category": "RAW_NET",
      "sku_code": "ip.residential.uk.*",
      "min_count": 1,
      "attributes": {
        "geo": "GB",
        "no_datacenter": true
      }
    }
    
    ```
    
    - å­—æ®µå«ä¹‰ï¼š
        - `sku_category`ï¼šèµ„æºå¤§ç±»ï¼ˆå¿…é¡»å­—æ®µï¼‰ï¼›
        - `sku_code`ï¼šå¯é€‰çš„ SKU æ¨¡å¼ï¼ˆå¯ä¸ºå‰ç¼€æˆ–ç²¾ç¡®å€¼ï¼Œç”±ç­–ç•¥è§£é‡Šï¼‰ï¼›
        - `min_count`ï¼šè‡³å°‘éœ€è¦å‡ ä¸ªæ­¤ç±»èµ„æºï¼ˆé»˜è®¤ 1ï¼‰ï¼›
        - `attributes`ï¼šä»»æ„é”®å€¼å¯¹ï¼Œç”¨äºè¿›ä¸€æ­¥ç»†åŒ–éœ€æ±‚ï¼ˆgeo/issuer_country/ç½‘ç»œç±»å‹ç­‰ï¼‰ã€‚

> è°ƒåº¦å™¨æ ¹æ® resource_hints + èµ„äº§æ± çŠ¶æ€ï¼ˆAssetSnapshotï¼‰
> 
> 
> å†³å®šåˆ›å»ºå¤šå°‘ Leaseï¼Œä»¥åŠç»‘å®šå“ªäº› assetã€‚
> 

---

### 3.8 ä»»åŠ¡çº§çº¦æŸä¸ç­–ç•¥ç‰ˆæœ¬

- `constraints`
    - è‡ªç”±å¯¹è±¡ï¼Œç”¨äºè¡¨è¾¾ä¸å…·ä½“æ‰§è¡Œç›¸å…³çš„çº¦æŸï¼Œä¾‹å¦‚ï¼š
        - `{"max_retries": 3, "no_datacenter_ip": true, "min_health_score": 70}`
- `tenant_policies_version`
    - æœ¬ä»»åŠ¡åœ¨åˆ›å»ºæ—¶æ‰€å¼•ç”¨çš„ç§Ÿæˆ·ç­–ç•¥ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚ `tenant_policy.v3`ã€‚
    - ä¾¿äºåç»­å›æ”¾æ—¶é‡ç°å½“æ—¶çš„ç­–ç•¥ç¯å¢ƒã€‚
- `tags`
    - å­—ç¬¦ä¸²æ•°ç»„ï¼Œç”¨äºæ‰“ä¸šåŠ¡æ ‡ç­¾ï¼Œä¾‹å¦‚ï¼š
        - `["a_b_test", "exp_group_A", "black_friday"]`

---

### 4. è®¾è®¡æ„å›¾

1. **å¹‚ç­‰æ€§æ˜¯äº¤æ˜“çº§åº•çº¿**
    - åœ¨é«˜é¢‘åœºæ™¯ï¼ˆæŠ¢ç¥¨ã€æ‰“ç ã€åˆæˆç›‘æ§ï¼‰ä¸­ï¼Œ
        
        ä¸Šæ¸¸è°ƒç”¨å¾ˆéš¾ä¿è¯â€œåªè°ƒä¸€æ¬¡â€ã€‚
        
    - é€šè¿‡ `(tenant_id, env, idempotency_key)` çš„å”¯ä¸€çº¦æŸï¼š
        - é‡è¯•åˆ›å»ºè¯·æ±‚ä¸ä¼šäº§ç”Ÿé‡å¤ Taskï¼›
        - ä¸é‡‘èç³»ç»Ÿçš„å¹‚ç­‰è¯­ä¹‰å¯¹é½ã€‚
2. **Task ä¸ç¢° Assetï¼Œåªç¢° Lease**
    - Task å…³å¿ƒâ€œè¦èµ„æºâ€å’Œâ€œç”¨äº†å“ªäº› Leaseâ€ï¼Œ
    - Asset å…³å¿ƒâ€œå½“å‰çŠ¶æ€å’Œå¥åº·åº¦â€ï¼Œ
    - Lease å…³å¿ƒâ€œæŸä¸€æ®µæ—¶é—´å†…ï¼ŒæŸ Task å¯¹æŸ Asset çš„å ç”¨å…³ç³»â€ã€‚
    - è¿™ç§ä¸‰å±‚ç»“æ„ä½¿å¾—ï¼š
        - èµ„äº§èƒ½åœ¨ä¸åŒ Task é—´å®‰å…¨å¤ç”¨ï¼›
        - Task å¯ä»¥éƒ¨åˆ†å¤ç”¨å†å² Leaseï¼ˆæ¯”å¦‚æ–­ç‚¹é‡è¯•ï¼‰ã€‚
3. **è°ƒåº¦å‹å¥½ï¼špriority + timeout_ms æ˜¯ä¸€ç­‰å…¬æ°‘**
    - `priority` å†³å®š**æ’é˜Ÿé¡ºåº**ï¼Œ
    - `timeout_ms` å†³å®š**æœ€å¤§æ‰§è¡Œçª—å£**ï¼Œ
    - è°ƒåº¦å¼•æ“å¯ä»¥ç”¨æå°‘å­—æ®µå®ç°ä¸€ä¸ªå¯è§£é‡Šçš„æŠ¢å /æ’é˜Ÿç­–ç•¥ã€‚
4. **ä»·å€¼ä¸æˆæœ¬ä¸€ä½“åŒ–**
    - `business_value_hint` + `max_total_cost` + `currency`
    - è®©è°ƒåº¦ä¸ FinOps å¯ä»¥åœ¨åŒä¸€æ•°æ®å¹³é¢ä¸Šå·¥ä½œï¼š
        - é«˜ä»·å€¼ä»»åŠ¡ç”¨é«˜è´¨é‡èµ„æºï¼›
        - æˆæœ¬è¶…æ ‡ä»»åŠ¡å¯ä»¥è‡ªåŠ¨é™çº§æˆ–ç»ˆæ­¢ã€‚

---

### 5. ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ 1ï¼šä¼¦æ•¦æŠ¢ç¥¨ä»»åŠ¡

```json
{
  "task_id": "...",
  "idempotency_key": "ticket-ts-lon-20250601-req-123",
  "tenant_id": "tenant_a",
  "project_id": "project_ticket",
  "env": "prod",
  "task_type": "TICKET_SNIPER",
  "task_category": "EXCHANGE",
  "priority": 90,
  "timeout_ms": 120000,
  "max_total_cost": 5.0,
  "currency": "USD",
  "business_value_hint": 50.0,
  "status": "PENDING",
  "resource_hints": [
    {
      "sku_category": "RAW_NET",
      "sku_code": "ip.residential.uk.*",
      "min_count": 1,
      "attributes": {
        "geo": "GB"
      }
    },
    {
      "sku_category": "RAW_FUND",
      "sku_code": "vcc.uk.visa.onetime.*",
      "min_count": 1
    }
  ],
  "task_version": 1,
  "created_at": "2025-06-22T10:00:00Z",
  "updated_at": "2025-06-22T10:00:00Z"
}

```

è°ƒåº¦å™¨ä¼šæ ¹æ® `resource_hints` ä» AssetSnapshot é€‰æ‹©åˆé€‚çš„ IP + VCCï¼Œåˆ›å»º Lease å¹¶ç»‘å®šåˆ° `lease_ids`ã€‚

### åœºæ™¯ 2ï¼šå¤šæ¬¡é‡è¯•çš„æ‰“ç ä»»åŠ¡ï¼ˆå¹‚ç­‰ä¿è¯ï¼‰

ä¸Šæ¸¸åœ¨ 3 ç§’å†…é‡è¯•ä¸¤æ¬¡åŒæ ·çš„è¯·æ±‚ï¼š

å‡ä½¿ç”¨ç›¸åŒ `(tenant_id, env, idempotency_key)`ï¼š

- ç¬¬ä¸€æ¬¡ï¼šåˆ›å»º Taskï¼Œè¿”å› `task_id=abc`ï¼›
- ç¬¬äºŒæ¬¡ï¼šç”±äºå¹‚ç­‰é”®ç›¸åŒï¼Œç³»ç»Ÿç›´æ¥è¿”å›åŒä¸€ä¸ª `task_id=abc`ï¼Œè€Œä¸æ˜¯å†æ–°å»ºä¸€æ¡è®°å½•ã€‚

LedgerEntry åªä¼šå›´ç»•è¿™ä¸€ä¸ª `task_id` è®°è´¦ï¼Œé¿å…é‡å¤æ”¶è´¹ã€‚

---

### 6. åä½œæç¤ºï¼ˆä¸å…¶ä»– Schema çš„å¥‘çº¦ï¼‰

1. **ä¸ AssetSnapshot çš„å…³ç³»**
    - TaskOrder **ä¸ç›´æ¥å¼•ç”¨ `asset_id`**ï¼›
    - æ‰€æœ‰èµ„æºç»‘å®šå…³ç³»é€šè¿‡ `lease_id` â†’ Lease â†’ AssetSnapshot å®Œæˆã€‚
2. **ä¸ AssetEvent çš„å…³ç³»**
    - Task çš„çŠ¶æ€å˜æ›´ï¼ˆRUNNING â†’ SUCCESS/FAILED/TIMEOUT ç­‰ï¼‰
        
        å¯è§¦å‘å¯¹åº”çš„ AssetEventï¼ˆä¾‹å¦‚æ ‡è®°æŸ IP å°ç¦ã€æŸå¡å¤±è´¥ï¼‰ã€‚
        
    - AssetEvent çš„ç»“æ„ä¼šåœ¨ `AssetEvent v1.0` ä¸­å®šä¹‰ï¼Œå¹¶çº¦æŸ `payload` çš„é¡¶å±‚é”®ï¼ŒåŒ…å«ï¼š
        - `error_code`
        - `external_latency_ms`
        - `provider_status`
        - `context`ï¼ˆé•¿å°¾ä¿¡æ¯ï¼‰ã€‚
3. **ä¸ LedgerEntry çš„å…³ç³»**
    - æ¯æ¬¡ä¸æˆæœ¬/æ”¶å…¥ç›¸å…³çš„åŠ¨ä½œï¼ˆè´­ä¹°èµ„æºã€æ‰§è¡Œä»»åŠ¡ã€å”®å– Productï¼‰
        
        å¿…é¡»äº§ç”Ÿè‡³å°‘ä¸€æ¡ `LedgerEntry`ï¼Œå¹¶æŒ‚ä¸Š `task_id`ã€‚
        
    - è¿™æ ·å¯ä»¥ä»ä»»åŠ¡ç»´åº¦è®¡ç®—ï¼š
        - æœ¬ä»»åŠ¡æ€»æˆæœ¬ï¼›
        - æŒ‰èµ„æºç±»å‹æ‹†åˆ†çš„æˆæœ¬ï¼›
        - æœ¬ä»»åŠ¡äº§ç”Ÿçš„æ”¶å…¥/æ¯›åˆ©ã€‚
4. **ä¸ Lease Schema çš„å…³ç³»**
    - Lease æ˜¯ Task ä¸ Asset çš„æ¡¥æ¢ï¼š
        - Lease è®°å½•â€œæŸ Task åœ¨æŸæ—¶é—´æ®µå ç”¨äº†æŸä¸ª assetâ€ï¼›
        - AssetSnapshot èšåˆ Lease å½¢æˆå½“å‰ `current_concurrency`ï¼›
        - TaskOrder é€šè¿‡ `lease_ids` è·å¾—â€œè‡ªå·±ç”¨è¿‡å“ªäº›èµ„æºâ€ã€‚
